<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="跨境电商工具导航">
    <!-- 阻止浏览器请求Vite客户端文件 -->
    <meta name="vite-dev-server" content="false">
    <meta name="dev-server" content="false">
    <title>跨境电商工具导航</title>
    <!-- 网站图标 -->
    <link rel="icon" type="image/svg+xml" href="../assets/favicon.ico">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/language-switcher.css">
    <!-- 引入数据和脚本 - 确保api.js先加载 -->
    <script src="../assets/js/api.js"></script>
    <!-- 确保index.js在api.js之后加载 -->
    <script src="../assets/js/index.js" defer></script>
    <script>
        // 加载组件的函数
        // 注意：此函数在下方有更完整的实现，这里移除重复定义

        // 初始化首页内容
        async function initializeIndexPage() {
            
            
            // 标记页面已初始化，避免重复初始化
            window.pageInitialized = true;
            
            try {
                // 首先尝试加载动态数据
                
                await loadCategoriesAndTools();
                
                
                // 加载侧边栏分类
                
                await loadSidebarCategories();
                
                
            } catch (error) {
                console.error('加载动态数据失败:', error);
                // 直接显示错误信息，不使用静态数据
                alert('数据加载失败，请刷新页面重试或联系管理员');
                throw new Error('数据加载失败: ' + error.message);
            }
            
            
        }
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function() {
            
            
            // 使用Promise.all确保所有组件都加载完成
            Promise.all([
                loadComponent('../components/header.html', 'header-component'),
                loadComponent('../components/sidebar.html', 'sidebar-component'),
                loadComponent('../components/footer.html', 'footer-component'),
                loadComponent('../components/card.html', 'card-component')
            ]).then(() => {
                console.log('所有组件加载完成');
                const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
                if (typeof window.applyLanguage === 'function') {
                    window.applyLanguage(savedLanguage);
                }
                
                // 直接检查卡片函数是否已加载（卡片组件是立即定义函数的）
                if (typeof window.createCountryCard === 'function' && 
                    typeof window.createWebsiteCard === 'function' &&
                    typeof window.createCategorySection === 'function') {
                    console.log('卡片函数已就绪，开始初始化页面');
                    if (!window.pageInitialized) {
                        initializeIndexPage();
                    }
                } else {
                    console.log('卡片函数未就绪，启动快速检查机制');
                    // 使用更快速的检查机制
                    checkCardFunctionsQuick();
                }
            }).catch(error => {
                console.error('组件加载失败:', error);
                // 即使组件加载失败，也尝试初始化页面
                setTimeout(() => {
                    window.cardFunctionCheckCount = 0;
                    checkCardFunctions();
                }, 1000);
            });
            
            // 快速检查机制（最多检查3次，每次100ms）
            function checkCardFunctionsQuick() {
                if (typeof window.createCountryCard === 'function' && 
                    typeof window.createWebsiteCard === 'function' &&
                    typeof window.createCategorySection === 'function') {
                    console.log('快速检查：卡片函数已就绪，开始初始化页面');
                    if (!window.pageInitialized) {
                        initializeIndexPage();
                    }
                    return;
                }
                
                if (!window.quickCheckCount) {
                    window.quickCheckCount = 1;
                } else {
                    window.quickCheckCount++;
                }
                
                console.log(`快速检查第${window.quickCheckCount}次...`);
                
                if (window.quickCheckCount >= 3) {
                    console.log('快速检查超时，使用标准检查机制');
                    window.cardFunctionCheckCount = 0;
                    checkCardFunctions();
                } else {
                    setTimeout(checkCardFunctionsQuick, 100);
                }
            }
        });

        // 卡片函数检查逻辑（作为备用方案）
        function checkCardFunctions() {
            if (typeof window.createCountryCard === 'function' && 
                typeof window.createWebsiteCard === 'function' &&
                typeof window.createCategorySection === 'function') {
                
                console.log('卡片函数检查通过，开始初始化页面');
                if (!window.pageInitialized) {
                    initializeIndexPage();
                }
            } else {
                // 如果超过5次检查仍未加载成功，则强制初始化页面
                if (!window.cardFunctionCheckCount) {
                    window.cardFunctionCheckCount = 1;
                } else {
                    window.cardFunctionCheckCount++;
                }
                
                console.log(`第${window.cardFunctionCheckCount}次检查卡片函数...`);
                
                if (window.cardFunctionCheckCount > 5) {
                    console.warn('卡片函数加载超时，强制初始化页面');
                    // 定义缺失的函数以避免错误
                    if (typeof window.createCountryCard !== 'function') {
                        window.createCountryCard = function(name, iconUrl, link) {
                            console.warn('使用临时createCountryCard函数');
                            const li = document.createElement('li');
                            li.className = 'country-item col-6 col-sm-4 col-md-3 col-lg-2';
                            li.innerHTML = `<a href="${link || '#'}" class="country-link text-decoration-none" target="_blank">
                                <div class="country-card-content p-2 text-center">
                                    <span class="country-icon d-block mb-1">
                                        <img src="${iconUrl || ''}" alt="${name}" class="country-img" width="32" height="24">
                                    </span>
                                    <span class="country-name small text-truncate d-block">${name}</span>
                                </div>
                            </a>`;
                            return li;
                        };
                    }
                    if (typeof window.createWebsiteCard !== 'function') {
                        window.createWebsiteCard = function(name, description, iconUrl, link) {
                            console.warn('使用临时createWebsiteCard函数');
                            const div = document.createElement('div');
                            div.className = 'col-md-4 col-sm-6 col-12 mb-3';
                            div.innerHTML = `<div class="website-card h-100">
                                <div class="website-card-content d-flex align-items-center p-3">
                                    <div class="website-logo me-3 flex-shrink-0">
                                        <img src="${iconUrl || 'https://www.google.com/s2/favicons?domain=example.com&sz=32'}" alt="${name}图标" class="card-logo">
                                    </div>
                                    <div class="website-info flex-grow-1 min-width-0">
                                        <div class="website-name fw-bold mb-1 text-truncate">${name}</div>
                                        <div class="website-desc text-muted small">${description || '点击访问'}</div>
                                    </div>
                                </div>
                            </div>`;
                            if (link && link !== '#') {
                                div.onclick = () => window.open(link, '_blank');
                                div.style.cursor = 'pointer';
                            }
                            return div;
                        };
                    }
                    if (typeof window.createCategorySection !== 'function') {
                        window.createCategorySection = function(title, iconClass, cards) {
                            console.warn('使用临时createCategorySection函数');
                            const section = document.createElement('section');
                            section.className = 'category-section';
                            section.innerHTML = `<header class="section-title d-flex justify-content-between align-items-center">
                                <div><i class="bi ${iconClass || 'bi-folder'}"></i> <span class="title-text">${title}</span></div>
                                <a href="#" class="text-decoration-none small d-none d-sm-inline">
                                    查看更多 <i class="bi bi-chevron-right"></i>
                                </a>
                            </header>
                            <div class="card-container row g-2 g-md-3"></div>`;
                            
                            const container = section.querySelector('.card-container');
                            if (cards && Array.isArray(cards)) {
                                cards.forEach(card => container.appendChild(card));
                            }
                            return section;
                        };
                    }
                    
                    if (!window.pageInitialized) {
                        initializeIndexPage();
                    }
                } else {
                    setTimeout(checkCardFunctions, 500); // 增加重试间隔到500ms
                }
            }
        }
        
        // 辅助函数：加载组件
        function loadComponent(url, containerId) {
            return fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`加载组件失败: ${url}`);
                    }
                    return response.text();
                })
                .then(data => {
                    const container = document.getElementById(containerId);
                    if (container) {
                        container.innerHTML = data;
                        
                    } else {
                        throw new Error(`找不到容器: ${containerId}`);
                    }
                });
        }
    </script>
</head>
<body>
    <!-- 移动端汉堡菜单按钮 -->
    <button class="navbar-toggler d-md-none" type="button" onclick="toggleSidebar()">
        <i class="bi bi-list"></i>
    </button>
    
    <!-- 移动端遮罩层 -->
    <div class="overlay" onclick="closeSidebar()"></div>

    <!-- 头部导航组件 -->
    <div id="header-component"></div>

    <!-- 主要内容区域 -->
    <div class="container">
        <div class="row">
            <!-- 左侧侧边栏组件 -->
            <div class="col-md-2 sidebar" id="sidebar">
                <div class="sidebar-header d-md-none">
                    <h5 data-lang="navigationMenu">导航菜单</h5>
                    <button class="sidebar-close" onclick="closeSidebar()">
                        <i class="bi bi-x"></i>
                    </button>
                </div>
                <div id="sidebar-component"></div>
            </div>
            
            <!-- 主内容区域 -->
            <div class="col-md-10 main-content">
                <!-- 网站LOGO和搜索区域 - 固定内容 -->
                <div class="site-header text-center py-4">
                    <!-- 搜索区域 -->
                    <div class="search-container">
                        <div class="search-tabs">
                            <button class="search-tab active" data-engine="baidu" data-lang="baiduSearch">百度</button>
                            <button class="search-tab" data-engine="google" data-lang="googleSearch">Google</button>
                            <button class="search-tab" data-engine="bing" data-lang="bingSearch">Bing</button>
                            <button class="search-tab" data-engine="yahoo" data-lang="yahooSearch">Yahoo</button>
                            <button class="search-tab" data-engine="yandex" data-lang="yandexSearch">Yandex</button>
                        </div>
                        <div class="search-box-main">
                            <input type="text" class="form-control main-search" data-lang-placeholder="searchPlaceholderMain" placeholder="输入关键词搜索..." autocomplete="off">
                            <button class="btn btn-search" onclick="performSearch()">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 时间和日期显示 - 固定内容 -->
                <div class="date-container">
                    <div class="row g-2">
                        <div class="col-6 col-md-3">
                            <div class="date-box">
                                <i class="bi bi-calendar"></i> 
                                <span class="d-none d-sm-inline" data-lang="usTimeLabel">美东时间: </span>
                                <span class="d-sm-none" data-lang="usTimeShort">美东: </span>
                                <span id="us-time">10:30:20</span>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="date-box">
                                <i class="bi bi-calendar"></i> 
                                <span class="d-none d-sm-inline" data-lang="ukTimeLabel">英国时间: </span>
                                <span class="d-sm-none" data-lang="ukTimeShort">英国: </span>
                                <span id="uk-time">15:30:20</span>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="date-box">
                                <i class="bi bi-calendar"></i> 
                                <span class="d-none d-sm-inline" data-lang="deTimeLabel">德国时间: </span>
                                <span class="d-sm-none" data-lang="deTimeShort">德国: </span>
                                <span id="de-time">16:30:20</span>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="date-box">
                                <i class="bi bi-calendar"></i> 
                                <span class="d-none d-sm-inline" data-lang="cnTimeLabel">中国时间: </span>
                                <span class="d-sm-none" data-lang="cnTimeShort">中国: </span>
                                <span id="cn-time">22:30:20</span>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 快捷导航区域 - 左右留白10% -->
                <div class="quick-nav px-10">
                    <h6 class="quick-nav-title">
                        <i class="bi bi-compass"></i> 
                        <span data-lang="quickNav">快捷导航</span>
                    </h6>
                    <div class="nav-buttons">
                        <button class="nav-btn active" data-platform="tradelink" data-lang="tradeLink">TradeLink</button>
                        <button class="nav-btn" data-platform="amazon" data-lang="amazon">亚马逊</button>
                        <button class="nav-btn" data-platform="ebay" data-lang="ebay">eBay</button>
                        <button class="nav-btn" data-platform="shopify" data-lang="shopify">Shopify</button>
                        <button class="nav-btn" data-platform="tiktok" data-lang="tiktokShop">TikTok Shop</button>
                        <button class="nav-btn" data-platform="aliexpress" data-lang="aliexpress">速卖通</button>
                        <button class="nav-btn" data-platform="wish" data-lang="wish">Wish</button>
                        <button class="nav-btn" data-platform="ecommerce" data-lang="crossBorderEcommerce">跨境电商</button>
                        <button class="nav-btn" data-platform="training" data-lang="amazonTraining">亚马逊培训</button>
                        <button class="nav-btn" data-platform="tools" data-lang="amazonTools">亚马逊工具</button>
                    </div>
                </div>
                
                <!-- 动态内容容器 - 这个容器会被switchToSite函数清空和填充 -->
                <div id="main-content">
                    <!-- 导航卡片组件 -->
                    <div id="card-component"></div>
                    
                    <!-- 国家/地区站点 -->
                    <div id="country-sites-container"></div>
                    
                    <!-- 网站分类展示 -->
                    <div id="categories-container" class="website-categories mt-4">
                        <!-- 工具分类容器 -->
                        <div id="tool-categories" class="tool-categories-container"></div>
                    </div>
                </div>
                
                <!-- 更多分类... -->
                
                
                <!-- 返回顶部按钮 -->
                <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
                    <i class="bi bi-arrow-up"></i>
                </button>
                
                <!-- 侧边工具栏 -->
                <div class="side-toolbar d-none d-md-flex">
                    <button class="toolbar-btn" title="分享" onclick="shareWebsite()">
                        <i class="bi bi-share"></i>
                    </button>
                    <button class="toolbar-btn" title="商务合作" data-lang-title="businessContact" onclick="showBusinessContact()">
                        <i class="bi bi-briefcase"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部信息组件 -->
    <div id="footer-component"></div>

    <!-- 商务合作联系方式弹窗 -->
    <div class="modal fade" id="businessContactModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" data-lang="businessContact">商务合作</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="bi bi-chat-dots me-2"></i>微信</div>
                            <div>
                                <code id="wechat-id">ThisDay_Chen</code>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyText('ThisDay_Chen')">复制</button>
                            </div>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="bi bi-whatsapp me-2"></i>WhatsApp</div>
                            <div>
                                <a href="https://wa.me/18666877674" target="_blank" rel="noopener">+86 18666877674</a>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyText('18666877674')">复制</button>
                            </div>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div><i class="bi bi-envelope me-2"></i>邮箱</div>
                            <div>
                                <a href="mailto:jaden.ecc@gmail.com">jaden.ecc@gmail.com</a>
                                <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyText('jaden.ecc@gmail.com')">复制</button>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript 引入 -->
    <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    
    <!-- 初始化Bootstrap下拉菜单 -->
    <script>
        // 确保Bootstrap下拉菜单正确初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化所有下拉菜单
            var dropdownElementList = [].slice.call(document.querySelectorAll('.dropdown-toggle'));
            var dropdownList = dropdownElementList.map(function (dropdownToggleEl) {
                return new bootstrap.Dropdown(dropdownToggleEl);
            });
        });
    </script>
    
    <!-- 移动端交互脚本 -->
    <script>
        // 侧边栏控制函数
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.overlay');
            
            sidebar.classList.toggle('show');
            overlay.classList.toggle('show');
            
            // 防止背景滚动
            if (sidebar.classList.contains('show')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }
        
        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.querySelector('.overlay');
            
            sidebar.classList.remove('show');
            overlay.classList.remove('show');
            document.body.style.overflow = '';
        }
        
        // 搜索功能
        function performSearch() {
            const searchInput = document.querySelector('.main-search');
            const activeTab = document.querySelector('.search-tab.active');
            const query = searchInput.value.trim();
            
            if (!query) {
                searchInput.focus();
                return;
            }
            
            const engine = activeTab.getAttribute('data-engine') || 'baidu';
            const searchUrls = {
                baidu: `https://www.baidu.com/s?wd=${encodeURIComponent(query)}`,
                google: `https://www.google.com/search?q=${encodeURIComponent(query)}`,
                bing: `https://www.bing.com/search?q=${encodeURIComponent(query)}`,
                yahoo: `https://search.yahoo.com/search?p=${encodeURIComponent(query)}`,
                yandex: `https://yandex.com/search/?text=${encodeURIComponent(query)}`
            };
            
            window.open(searchUrls[engine], '_blank');
        }
        
        // 搜索引擎切换
        document.addEventListener('DOMContentLoaded', function() {
            const searchTabs = document.querySelectorAll('.search-tab');
            const searchInput = document.querySelector('.main-search');
            
            searchTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    searchTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // 回车搜索
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
        });
        
        // 快捷导航按钮交互
        document.addEventListener('DOMContentLoaded', function() {
            const navButtons = document.querySelectorAll('.nav-btn');
            
            navButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    navButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const platform = this.getAttribute('data-platform');
                    
                    // 这里可以添加平台切换逻辑
                });
            });
        });
        
        // 返回顶部功能
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // 显示/隐藏返回顶部按钮
        window.addEventListener('scroll', function() {
            const backToTop = document.getElementById('backToTop');
            if (window.pageYOffset > 300) {
                backToTop.classList.add('show');
            } else {
                backToTop.classList.remove('show');
            }
        });
        
        // 工具栏功能
        function shareWebsite() {
            if (navigator.share) {
                navigator.share({
                    title: '跨境电商工具导航',
                    text: '发现最好的跨境电商工具和资源',
                    url: window.location.href
                });
            } else {
                // 复制链接到剪贴板
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('链接已复制到剪贴板');
                });
            }
        }
        
        function bookmarkWebsite() {
            // 已取消收藏浮窗，不执行任何操作
            return;
        }
        
        function showBusinessContact() {
            const modalEl = document.getElementById('businessContactModal');
            if (!modalEl) return;
            const modal = new bootstrap.Modal(modalEl);
            modal.show();
        }

        function copyText(text) {
            if (!text) return;
            navigator.clipboard.writeText(text).then(() => {
                // 轻量提示，无弹窗干扰
                const toast = document.createElement('div');
                toast.className = 'position-fixed top-0 start-50 translate-middle-x p-2';
                toast.style.zIndex = '1080';
                toast.innerHTML = '<span class="badge bg-success">已复制</span>';
                document.body.appendChild(toast);
                setTimeout(() => document.body.removeChild(toast), 1200);
            });
        }
        
        // 实时时间更新
        function updateTimes() {
            const now = new Date();
            
            // 美东时间 (UTC-5/-4)
            const usTime = new Date(now.toLocaleString("en-US", {timeZone: "America/New_York"}));
            document.getElementById('us-time').textContent = usTime.toLocaleTimeString();
            
            // 英国时间 (UTC+0/+1)
            const ukTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/London"}));
            document.getElementById('uk-time').textContent = ukTime.toLocaleTimeString();
            
            // 德国时间 (UTC+1/+2)
            const deTime = new Date(now.toLocaleString("en-US", {timeZone: "Europe/Berlin"}));
            document.getElementById('de-time').textContent = deTime.toLocaleTimeString();
            
            // 中国时间 (UTC+8)
            const cnTime = new Date(now.toLocaleString("en-US", {timeZone: "Asia/Shanghai"}));
            document.getElementById('cn-time').textContent = cnTime.toLocaleTimeString();
        }
        
        // 每秒更新时间
        setInterval(updateTimes, 1000);
        updateTimes(); // 立即更新一次
        
        // 触摸设备优化
        if ('ontouchstart' in window) {
            // 为触摸设备添加特殊样式
            document.body.classList.add('touch-device');
            
            // 防止双击缩放
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }
    </script>
</body>
</html>